<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chores</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
body { font-family:'Roboto',sans-serif; margin:0; padding:0; background:#fdfdfd; color:#333; }
h2 { text-align:center; margin:1.5rem 0; color:#111; font-weight:500; }

.site-container { max-width:1200px; margin:0 auto; padding:0 20px; }

.tab-container { display:flex; justify-content:center; background:#f8f8f8; border-bottom:1px solid #ddd; border-radius:12px 12px 0 0; overflow:hidden; }
.tab { flex:1; padding:8px 0; text-align:center; cursor:pointer; display:flex; flex-direction:column; align-items:center; }
.tab.active { background:#fff; font-weight:600; box-shadow: inset 0 -2px 0 #007aff; }
.rank-circle { margin-top:4px; width:55px; height:24px; border-radius:12px; background:#007aff; color:#fff; font-size:13px; display:flex; justify-content:center; align-items:center; }

.table-container { display:none; padding:1rem 0; }
.table-container.active { display:block; }

table { width:100%; border-collapse:separate; border-spacing:0; background:#fff; border-radius:12px; overflow:hidden; table-layout:fixed; }
th, td { padding:6px; font-size:13px; border-bottom:1px solid #eee; text-align:center; }
tr.total-row td { font-weight:500; background:#f9f9f9; }

input[type="checkbox"] { appearance:none; width:28px; height:16px; background:#e6e6e6; border-radius:12px; position:relative; cursor:pointer; }
input[type="checkbox"]:checked { background:#007aff; }
input[type="checkbox"]::before { content:""; position:absolute; width:12px; height:12px; border-radius:50%; top:2px; left:2px; background:#fff; transition: transform 0.3s ease; }
input[type="checkbox"]:checked::before { transform:translateX(12px); }

input[type="number"], input[type="text"] { border:1px solid #ccc; border-radius:8px; padding:4px; text-align:center; }

.progress-wrapper { width:100%; margin-top:10px; border-radius:12px; background:#ccc; overflow:hidden; height:26px; }
.progress-bar { background:#007aff; height:100%; width:0%; text-align:center; line-height:26px; font-weight:500; color:#fff; transition:width 0.3s ease; }

.bottom-controls { display:flex; justify-content:space-between; align-items:center; margin-top:12px; gap:10px; flex-wrap:wrap; }
.btn { padding:6px 12px; border:none; border-radius:8px; cursor:pointer; background:#007aff; color:#fff; font-weight:500; }
.btn:hover { background:#005bb5; }

#trait-display span {
  background:#f2f2f2;
  padding:6px 10px;
  border-radius:12px;
  margin:4px;
  display:inline-block;
}

</style>
</head>
<body>

<h2>Chores</h2>

<div class="site-container">

<div class="tab-container">
<div class="tab active" data-kid="Ryan">Ryan<div class="rank-circle" id="rank-Ryan">$0.00</div></div>
<div class="tab" data-kid="Jack">Jack<div class="rank-circle" id="rank-Jack">$0.00</div></div>
<div class="tab" data-kid="Henry">Henry<div class="rank-circle" id="rank-Henry">$0.00</div></div>
<div class="tab" data-kid="Sonny">Sonny<div class="rank-circle" id="rank-Sonny">$0.00</div></div>
</div>

<div id="Ryan" class="table-container active"></div>
<div id="Jack" class="table-container"></div>
<div id="Henry" class="table-container"></div>
<div id="Sonny" class="table-container"></div>

<!-- Controls Row -->
<div class="bottom-controls">

<!-- LEFT: Trait Input -->
<div style="display:flex; gap:8px;">
<input type="text" id="trait-input" placeholder="Enter trait (e.g. Kind)" style="width:180px;">
<button class="btn" id="add-trait">Add</button>
</div>

<!-- RIGHT: Week Controls -->
<div style="display:flex; gap:8px;">
<select id="week-select"></select>
<button class="btn" id="archive-week">Archive Week</button>
<button class="btn" id="clear-week">Clear Week</button>
</div>

</div>

<!-- Trait Log -->
<div id="trait-display" style="margin-top:12px; text-align:center; font-weight:500;"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig = {
apiKey:"YOUR_KEY",
authDomain:"YOUR_AUTH",
projectId:"YOUR_PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const kids=["Ryan","Jack","Henry","Sonny"];
const days=["Mon","Tues","Wed","Thurs","Fri","Sat","Sun"];
const chores=[{key:"showerTeeth"},{key:"bedRoom"},{key:"clothes"},{key:"other"},{key:"deduction"}];
const activities=["reading","practice","workout"];

const CHORE_VALUE=0.25;
const ACTIVITY_RATE=0.05;
const DEDUCTION_VALUE=-3;
const WEEKLY_GOAL=20;

let currentWeek="default";
let activeKid="Ryan";

function buildTables(){
kids.forEach(kid=>{
const container=document.getElementById(kid);
let html=`<table><thead><tr><th></th>`;
days.forEach(day=> html+=`<th>${day}</th>`);
html+=`</tr></thead><tbody>`;

[...chores,...activities.map(a=>({key:a}))].forEach(c=>{
html+=`<tr><td>${c.key}</td>`;
days.forEach((d,i)=>{
if(c.key==="deduction"||!activities.includes(c.key)){
html+=`<td><input type="checkbox" data-kid="${kid}" data-day="${i}" data-type="${c.key}"></td>`;
}else{
html+=`<td><input type="number" min="0" data-kid="${kid}" data-day="${i}" data-type="${c.key}"></td>`;
}
});
html+=`</tr>`;
});
html+=`<tr class="total-row"><td>Total</td>`;
days.forEach((d,i)=> html+=`<td id="${kid}-total-${i}">$0.00</td>`);
html+=`</tr></tbody></table>
<div class="progress-wrapper"><div id="${kid}-progress" class="progress-bar">$0.00</div></div>`;
container.innerHTML=html;
});
}

function updateTotals(){
kids.forEach(kid=>{
let kidTotal=0;
days.forEach((d,i)=>{
let dayTotal=0;

chores.forEach(c=>{
const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${c.key}"]`);
if(input){
if(c.key==="deduction" && input.checked) dayTotal+=DEDUCTION_VALUE;
else if(c.key!=="deduction" && input.checked) dayTotal+=CHORE_VALUE;
}
});

activities.forEach(a=>{
const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${a}"]`);
if(input && input.value) dayTotal+=parseFloat(input.value||0)*ACTIVITY_RATE;
});

kidTotal+=dayTotal;
document.getElementById(`${kid}-total-${i}`).textContent=`$${dayTotal.toFixed(2)}`;
});

document.getElementById(`${kid}-progress`).style.width=Math.min((kidTotal/WEEKLY_GOAL)*100,100)+"%";
document.getElementById(`${kid}-progress`).textContent=`$${kidTotal.toFixed(2)}`;
document.getElementById(`rank-${kid}`).textContent=`$${kidTotal.toFixed(2)}`;
});
}

async function addTrait(word){
if(!word) return;
const ref=db.collection('weeks').doc(currentWeek).collection('traits').doc(activeKid);
const doc=await ref.get();
let data=doc.exists?doc.data():{};
word=word.trim().toLowerCase();
data[word]=(data[word]||0)+1;
await ref.set(data);
loadTraits();
}

async function loadTraits(){
const ref=db.collection('weeks').doc(currentWeek).collection('traits').doc(activeKid);
const doc=await ref.get();
const display=document.getElementById('trait-display');
display.innerHTML="";
if(doc.exists){
const data=doc.data();
Object.keys(data).sort((a,b)=>data[b]-data[a]).forEach(word=>{
display.innerHTML+=`<span>${word.charAt(0).toUpperCase()+word.slice(1)} (${data[word]})</span>`;
});
}
}

document.getElementById('add-trait').addEventListener('click',()=>{
const input=document.getElementById('trait-input');
addTrait(input.value);
input.value="";
});

document.getElementById('trait-input').addEventListener('keypress',e=>{
if(e.key==="Enter") document.getElementById('add-trait').click();
});

document.querySelectorAll(".tab").forEach(tab=>{
tab.addEventListener("click",()=>{
document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
document.querySelectorAll(".table-container").forEach(c=>c.classList.remove("active"));
tab.classList.add("active");
document.getElementById(tab.dataset.kid).classList.add("active");
activeKid=tab.dataset.kid;
loadTraits();
});
});

window.onload=()=>{
buildTables();
loadTraits();
document.body.addEventListener('change',e=>{
if(e.target.matches("input")) updateTotals();
});
};

</script>
</body>
</html>
