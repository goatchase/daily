<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kids Chore Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Roboto', sans-serif;
  margin: 0;
  padding: 0;
  background: #f5f2ea;
  color: #3b3b3b;
}

h2 {
  text-align: center;
  margin: 1rem 0;
  color: #2b2b2b;
  font-weight: 500;
}

/* Tabs */
.tab-container {
  display: flex;
  justify-content: center;
  background: #3a5a40;
  border-bottom: 2px solid #cbbf9a;
}
.tab {
  flex: 1;
  padding: 14px;
  text-align: center;
  color: #fff;
  cursor: pointer;
  font-weight: 500;
  border-right: 1px solid #7b5e3b;
  position: relative;
}
.tab:last-child { border-right: none; }
.tab.active { background: #6e5a3e; }

.tab .rank-circle {
  position: absolute;
  top: 4px;
  right: 8px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #ffd700;
  color: #000;
  font-size: 12px;
  font-weight: 500;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Table */
.table-container {
  display: none;
  padding: 1rem;
  max-width: 1200px;
  margin: auto;
  overflow-x: auto;
}
.table-container.active { display: block; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 8px;
  background: #f5f2ea;
  table-layout: fixed;
}
th, td {
  padding: 8px;
  font-size: 14px;
  border-bottom: 1px solid #cbbf9a;
  text-align: center;
  white-space: nowrap;
}
td:first-child, th:first-child { text-align: left; }

/* Icon row above headers */
th.icon-header {
  font-size: 18px;
  padding-bottom: 2px;
}

/* Total row */
tr.total-row td { background: #f5f2ea; font-weight: 500; }

/* Current day border */
tr.current-day td:first-child {
  border-left: 2px solid #355e3b;
}
tr.current-day td:last-child {
  border-right: 2px solid #355e3b;
}
tr.current-day td {
  border-top: 2px solid #355e3b;
  border-bottom: 2px solid #355e3b;
}

/* Inputs */
input[type="number"], input[type="text"] {
  width: 60px;
  border: none;
  text-align: center;
  border-radius: 4px;
  background: #f5f2ea;
}
input[type="checkbox"] { transform: scale(1.2); background: #f5f2ea; }

/* Progress bar */
.progress { background: #eee2d5; border-radius: 8px; overflow: hidden; height: 28px; border: 1px solid #cbbf9a; margin-top: 8px; }
.progress-bar { background: #3a5a40; height: 100%; width: 0; text-align: center; color: #fff; line-height: 28px; font-weight: 500; transition: width 0.3s; }

.clear-btn { display: block; margin: 8px auto; padding: 6px 12px; font-size: 14px; background: #c77b39; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
.clear-btn:hover { background: #b06527; }
</style>
</head>
<body>

<h2>Kids Chore Tracker</h2>

<div class="tab-container">
  <div class="tab active" data-kid="Ryan">Ryan <div class="rank-circle" id="rank-Ryan">-</div></div>
  <div class="tab" data-kid="Jack">Jack <div class="rank-circle" id="rank-Jack">-</div></div>
  <div class="tab" data-kid="Henry">Henry <div class="rank-circle" id="rank-Henry">-</div></div>
  <div class="tab" data-kid="Sonny">Sonny <div class="rank-circle" id="rank-Sonny">-</div></div>
</div>

<div id="Ryan" class="table-container active"></div>
<div id="Jack" class="table-container"></div>
<div id="Henry" class="table-container"></div>
<div id="Sonny" class="table-container"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAO_SS5Q1SDNTq9wK5B7bTyp5nhPT5Pf84",
  authDomain: "chores-18a66.firebaseapp.com",
  projectId: "chores-18a66",
  storageBucket: "chores-18a66.firebasestorage.app",
  messagingSenderId: "785602926667",
  appId: "1:785602926667:web:f87426009cc83bc77095ce",
  measurementId: "G-DELL5N4DTG"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
const kids=["Ryan","Jack","Henry","Sonny"];
const days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
const chores=[
  { key:"showerTeeth", label:"Shower, Teeth", icon:"🛁" },
  { key:"bedRoom", label:"Bed, Room", icon:"🛏️" },
  { key:"clothes", label:"Clothes", icon:"👕" },
  { key:"other", label:"Other", icon:"⭐" }
];
const activities=["reading","practice","workout"];
const activityIcons={reading:"📖", practice:"🏈", workout:"💪"};
const CHORE_VALUE=0.25, MINUTE_VALUE=0.05;

function getRankColor(ratio){
  const r1=53, g1=94, b1=59;
  const r2=139, g2=94, b2=60;
  const r=Math.round(r1 + (r2-r1)*ratio);
  const g=Math.round(g1 + (g2-g1)*ratio);
  const b=Math.round(b1 + (b2-b1)*ratio);
  return `rgb(${r},${g},${b})`;
}

const todayIndex = new Date().getDay()===0?6:new Date().getDay()-1;

kids.forEach(kid=>{
  const container=document.getElementById(kid);
  let html=`<table><thead>
  <tr><th></th>${[...chores.map(c=>c.icon), ...activities.map(a=>activityIcons[a])].map(i=>`<th class="icon-header">${i}</th>`).join("")}</tr>
  <tr><th>Day</th>${chores.map(c=>`<th>${c.label}</th>`).join("")}${activities.map(a=>`<th>${a.charAt(0).toUpperCase()+a.slice(1)}</th>`).join("")}</tr></thead><tbody>`;
  
  days.forEach((day,i)=>{
    const currentClass = i===todayIndex ? 'current-day' : '';
    html+=`<tr class="${currentClass}">
      <td>${day}</td>
      ${chores.map(c=>`<td><input type="checkbox" data-kid="${kid}" data-day="${i}" data-type="${c.key}"></td>`).join("")}
      ${activities.map(a=>`<td><input type="number" min="0" data-kid="${kid}" data-day="${i}" data-type="${a}"></td>`).join("")}
    </tr>`;
  });
  
  html+=`<tr class="total-row"><th>Total</th>${chores.map(c=>`<td id="${kid}-${c.key}-total">0/7</td>`).join("")}${activities.map(a=>`<td id="${kid}-${a}-total">0</td>`).join("")}</tr></tbody></table>
  <div class="progress"><div id="${kid}-progress" class="progress-bar">$0.00</div></div>
  <button class="clear-btn" onclick="clearKid('${kid}')">Clear Week</button>`;
  
  container.innerHTML=html;
});

// Firestore functions
function saveData(kid){
  const data={};
  days.forEach((day,i)=>{
    [...chores.map(c=>c.key), ...activities].forEach(type=>{
      const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${type}"]`);
      if(input){
        if(chores.some(c=>c.key===type)) data[`${i}-${type}`]=input.checked;
        else data[`${i}-${type}`]=input.value;
      }
    });
  });
  db.collection("chores").doc(kid).set(data).then(()=>updateTotals());
}

function loadData(){
  const promises = kids.map(kid=>{
    return db.collection("chores").doc(kid).get().then(doc=>{
      const data = doc.exists ? doc.data() : {};
      days.forEach((day,i)=>{
        [...chores.map(c=>c.key), ...activities].forEach(type=>{
          const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${type}"]`);
          if(input){
            if(chores.some(c=>c.key===type)) input.checked = data[`${i}-${type}`]||false;
            else input.value = data[`${i}-${type}`]||"";
          }
        });
      });
    });
  });

  Promise.all(promises).then(()=>updateTotals());
}

// Totals
function updateTotals(){
  const totals={};
  kids.forEach(kid=>{
    let totalChores=0;
    let actTotals={};
    activities.forEach(a=>actTotals[a]=0);
    
    chores.forEach(c=>{
      let count=0;
      days.forEach((day,i)=>{
        const box=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${c.key}"]`);
        if(box && box.checked){count++; totalChores++;}
      });
      document.getElementById(`${kid}-${c.key}-total`).textContent=`${count}/7`;
    });
    
    activities.forEach(a=>{
      days.forEach((day,i)=>{
        const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${a}"]`);
        if(input && input.value) actTotals[a]+=parseInt(input.value)||0;
      });
      document.getElementById(`${kid}-${a}-total`).textContent=actTotals[a];
    });
    
    const money=(totalChores*CHORE_VALUE) + Object.values(actTotals).reduce((sum,v)=>sum+v*MINUTE_VALUE,0);
    const percent=Math.min(100,Math.round((money/20)*100));
    const bar=document.getElementById(`${kid}-progress`);
    bar.style.width=percent+"%";
    bar.textContent="$"+money.toFixed(2);

    totals[kid]={...actTotals, money};
    chores.forEach(c=>totals[kid][c.key] = parseInt(document.getElementById(`${kid}-${c.key}-total`).textContent.split("/")[0])||0);
  });

  // Overall rank in tabs
  let overall=kids.map(k=>({kid:k,value:totals[k].money}));
  overall.sort((a,b)=>b.value-a.value);
  overall.forEach((v,i)=>document.getElementById(`rank-${v.kid}`).textContent=i+1);
}

// Clear
function clearKid(kid){
  db.collection("chores").doc(kid).delete().then(()=>{
    document.querySelectorAll(`#${kid} input`).forEach(i=>{if(i.type==='checkbox') i.checked=false; else i.value="";});
    updateTotals();
  });
}

// Input listeners
document.body.addEventListener("input", e=>{if(e.target.dataset.kid) saveData(e.target.dataset.kid)});
document.body.addEventListener("change", e=>{if(e.target.dataset.kid) saveData(e.target.dataset.kid)});

// Tabs
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".table-container").forEach(c=>c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.kid).classList.add("active");
  });
});

loadData();
</script>
</body>
</html>
