<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chore Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Roboto', sans-serif;
  margin: 0;
  padding: 0;
  background: #f5f2ea;
  color: #3b3b3b;
}

h2 {
  text-align: center;
  margin: 1rem 0;
  color: #2b2b2b;
  font-weight: 500;
}

/* Tabs */
.tab-container {
  display: flex;
  justify-content: center;
  background: #3a5a40;
  border-bottom: 2px solid #cbbf9a;
}
.tab {
  flex: 1;
  padding: 10px 0;
  text-align: center;
  color: #fff;
  cursor: pointer;
  font-weight: 500;
  border-right: 1px solid #7b5e3b;
  position: relative;
}
.tab:last-child { border-right: none; }
.tab.active { background: #6e5a3e; }

.tab .rank-circle {
  position: absolute;
  top: 4px;
  right: 8px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #ffd700;
  color: #000;
  font-size: 12px;
  font-weight: 500;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Table */
.table-container {
  display: none;
  padding: 0 10px 20px;
  max-width: 100%;
  margin: auto;
  overflow-x: auto;
}
.table-container.active { display: block; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 8px;
  background: #f5f2ea;
  table-layout: fixed;
}
th, td {
  padding: 6px;
  font-size: 14px;
  border-bottom: 1px solid #cbbf9a;
  text-align: center;
  white-space: nowrap;
}
th.current-day {
  background: #d1e7dd;
}
tr.total-row td { 
  background: #f5f2ea; 
  font-weight: 500; 
}
input[type="checkbox"] { transform: scale(1.2); vertical-align: middle; }
input[type="number"] { width: 30px; border: none; text-align: center; font-size: 14px; font-weight: 500; border-radius: 4px; background: #f5f2ea; vertical-align: middle; }

/* Progress bar */
.progress { 
  background: #eee2d5; 
  border-radius: 8px; 
  overflow: hidden; 
  height: 28px; 
  border: 1px solid #cbbf9a; 
  margin-top: 8px; 
}
.progress-bar { 
  background: #3a5a40; 
  height: 100%; 
  width: 0; 
  text-align: center; 
  color: #fff; 
  line-height: 28px; 
  font-weight: 500; 
  transition: width 0.3s; 
}

.clear-btn { 
  display: block; 
  margin: 8px auto; 
  padding: 6px 12px; 
  font-size: 14px; 
  background: #c77b39; 
  color: #fff; 
  border: none; 
  border-radius: 4px; 
  cursor: pointer; 
}
.clear-btn:hover { background: #b06527; }

/* Loader */
#loader { text-align:center; padding:20px; font-size:1.2rem; color:#3a5a40; }

/* Mobile */
@media (max-width: 768px){
  .table-container { overflow-x: auto; }
  table { min-width: 600px; }
}
</style>
</head>
<body>

<h2>Chore Tracker</h2>

<div class="tab-container">
  <div class="tab active" data-kid="Ryan">Ryan <div class="rank-circle" id="rank-Ryan">-</div></div>
  <div class="tab" data-kid="Jack">Jack <div class="rank-circle" id="rank-Jack">-</div></div>
  <div class="tab" data-kid="Henry">Henry <div class="rank-circle" id="rank-Henry">-</div></div>
  <div class="tab" data-kid="Sonny">Sonny <div class="rank-circle" id="rank-Sonny">-</div></div>
</div>

<div id="loader">Loading...</div>

<div id="tables">
  <div id="Ryan" class="table-container active"></div>
  <div id="Jack" class="table-container"></div>
  <div id="Henry" class="table-container"></div>
  <div id="Sonny" class="table-container"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.25.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.25.2/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const kids=["Ryan","Jack","Henry","Sonny"];
const days=["Mon","Tues","Wed","Thurs","Fri","Sat","Sun"];
const chores=[{ key:"showerTeeth", label:"Shower, Teeth", icon:"üöøü¶∑" },
              { key:"bedRoom", label:"Bed, Room", icon:"üõèÔ∏èüßπ" },
              { key:"clothes", label:"Clothes", icon:"üëïüß∫" },
              { key:"other", label:"Other", icon:"‚≠ê" },
              { key:"deduction", label:"Deduction", icon:"‚ûñ" }];
const activities=["reading","practice","workout"];
const activityIcons={reading:"üìñ‚úèÔ∏è", practice:"üèà‚öæ", workout:"üèãÔ∏è‚Äç‚ôÇÔ∏èüí™"};
const CHORE_VALUE=0.25, MINUTE_VALUE=0.05;

const todayIndex = new Date().getDay()===0?6:new Date().getDay()-1;

async function loadTables(){
  for(const kid of kids){
    const container=document.getElementById(kid);
    let html=`<table><thead><tr><th></th>`;
    days.forEach((day,i)=>{
      const highlight = i===todayIndex ? 'current-day' : '';
      html+=`<th class="${highlight}">${day}</th>`;
    });
    html+=`</tr></thead><tbody>`;

    [...chores, ...activities.map(a=>({key:a, icon:activityIcons[a]}))].forEach(c=>{
      html+=`<tr><td>${c.icon}</td>`;
      days.forEach((day,i)=>{
        if(c.key==="deduction" || !["reading","practice","workout"].includes(c.key)){
          html+=`<td><input type="checkbox" data-kid="${kid}" data-day="${i}" data-type="${c.key}"></td>`;
        } else {
          html+=`<td><input type="number" min="0" data-kid="${kid}" data-day="${i}" data-type="${c.key}"></td>`;
        }
      });
      html+=`</tr>`;
    });

    html+=`<tr class="total-row"><td>Total</td>`;
    days.forEach((day,i)=> html+=`<td id="${kid}-total-${i}">0/7</td>`);
    html+=`</tr></tbody></table>
           <div class="progress"><div id="${kid}-progress" class="progress-bar">0%</div></div>
           <button class="clear-btn" onclick="clearKid('${kid}')">Clear Week</button>`;
    container.innerHTML=html;
  }

  await loadDataFromFirebase();
  document.getElementById("loader").style.display="none";
  document.getElementById("tables").style.display="block";
}

async function loadDataFromFirebase(){
  for(const kid of kids){
    const doc = await db.collection("chores").doc(kid).get({ source: 'server' });
    const data = doc.exists ? doc.data() : {};
    days.forEach((day,i)=>{
      [...chores.map(c=>c.key), ...activities].forEach(type=>{
        const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${type}"]`);
        if(input){
          if(chores.some(c=>c.key===type)) input.checked = data[`${i}-${type}`]||false;
          else input.value = data[`${i}-${type}`]||"";
        }
      });
    });
  }
  updateTotals();
}

function saveToFirebase(kid){
  const data={};
  days.forEach((day,i)=>{
    [...chores.map(c=>c.key), ...activities].forEach(type=>{
      const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${type}"]`);
      if(input){
        if(chores.some(c=>c.key===type)) data[`${i}-${type}`]=input.checked;
        else data[`${i}-${type}`]=input.value;
      }
    });
  });
  db.collection("chores").doc(kid).set(data);
  updateTotals();
}

function clearKid(kid){
  db.collection("chores").doc(kid).delete();
  document.querySelectorAll(`#${kid} input`).forEach(i=>{ if(i.type==='checkbox') i.checked=false; else i.value=""; });
  updateTotals();
}

function updateTotals(){
  kids.forEach(kid=>{
    days.forEach((day,i)=>{
      let choreCount=0;
      chores.forEach(c=>{
        const input=document.querySelector(`[data-kid="${kid}"][data-day="${i}"][data-type="${c.key}"]`);
        if(input && input.checked) choreCount++;
      });
      document.getElementById(`${kid}-total-${i}`).textContent=`${choreCount}/7`;
    });
    // update progress bar (percentage)
    const totalChores = chores.length*days.length;
    let done=0;
    for(let d=0; d<days.length; d++){
      chores.forEach(c=>{
        const input=document.querySelector(`[data-kid="${kid}"][data-day="${d}"][data-type="${c.key}"]`);
        if(input && input.checked) done++;
      });
    }
    const percent=Math.round(done/totalChores*100);
    document.getElementById(`${kid}-progress`).style.width=percent+"%";
    document.getElementById(`${kid}-progress`).textContent=percent+"%";
  });

  // Update ranks
  let overall=kids.map(k=>{
    let total=0;
    days.forEach((day,i)=>{
      const val=parseInt(document.getElementById(`${k}-total-${i}`).textContent.split('/')[0])||0;
      total+=val;
    });
    return {kid:k,value:total};
  });
  overall.sort((a,b)=>b.value-a.value);
  overall.forEach((v,i)=>document.getElementById(`rank-${v.kid}`).textContent=i+1);
}

// Event listeners
document.body.addEventListener("input", e=>{ if(e.target.dataset.kid) saveToFirebase(e.target.dataset.kid); });
document.body.addEventListener("change", e=>{ if(e.target.dataset.kid) saveToFirebase(e.target.dataset.kid); });

document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".table-container").forEach(c=>c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.kid).classList.add("active");
  });
});

// Initialize
loadTables();
</script>
</body>
</html>
