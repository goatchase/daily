<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kids Chore Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background-color: #2e5339;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 12px;
      color: white;
      cursor: pointer;
      border: none;
      outline: none;
      font-weight: 500;
      position: relative;
    }
    .tab.active {
      background-color: #1e3a29;
    }
    .rank-bubble {
      position: absolute;
      top: 6px;
      right: 10px;
      background: #ff8c00;
      color: white;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    .content {
      display: none;
      padding: 15px;
    }
    .content.active {
      display: block;
    }
    .table-container {
      width: 100%;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
      white-space: nowrap; /* prevents wrapping */
    }
    th:first-child, td:first-child {
      text-align: center;
      width: 120px;
    }
    .current-day {
      background-color: #e6ffe6 !important;
    }
    .progress-container {
      margin-top: 15px;
      background: #ddd;
      border-radius: 20px;
      overflow: hidden;
      height: 24px;
      width: 80%;
      margin-left: auto;
      margin-right: auto;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      background-color: #2e5339;
      color: white;
      text-align: center;
      line-height: 24px;
      font-size: 14px;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <div class="tabs" id="tabs"></div>
  <div id="contents"></div>
  <div class="progress-container">
    <div class="progress-bar" id="progressBar">0%</div>
  </div>

  <script>
    const kids = ["Ryan", "Jack", "Henry", "Will"];
    const chores = [
      { icon: "🚿", type: "chore" }, 
      { icon: "🦷", type: "chore" }, 
      { icon: "🛏️", type: "chore" }, 
      { icon: "🧹", type: "chore" }, 
      { icon: "📖", type: "other" }, 
      { icon: "💪", type: "other" }, 
      { icon: "➖", type: "deduction" }
    ];
    const days = ["MON","TUES","WED","THURS","FRI","SAT","SUN"];

    const tabs = document.getElementById("tabs");
    const contents = document.getElementById("contents");

    kids.forEach((kid, index) => {
      const tab = document.createElement("button");
      tab.className = "tab" + (index === 0 ? " active" : "");
      tab.textContent = kid;

      const bubble = document.createElement("div");
      bubble.className = "rank-bubble";
      bubble.textContent = "0";
      tab.appendChild(bubble);

      tab.onclick = () => setActiveTab(index);
      tabs.appendChild(tab);

      const content = document.createElement("div");
      content.className = "content" + (index === 0 ? " active" : "");
      content.innerHTML = `
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Chore</th>
                ${days.map(day => `<th>${day}</th>`).join("")}
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              ${chores.map(chore => `
                <tr>
                  <td>${chore.icon}</td>
                  ${days.map((_, dayIndex) => {
                    if (chore.type === "chore") {
                      return `<td><input type="checkbox" data-type="chore" data-day="${dayIndex}" data-kid="${kid}"></td>`;
                    } else {
                      return `<td><input type="number" min="0" value="0" data-type="${chore.type}" data-day="${dayIndex}" data-kid="${kid}" style="width:40px;"></td>`;
                    }
                  }).join("")}
                  <td class="total">0</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      `;
      contents.appendChild(content);
    });

    function setActiveTab(index) {
      document.querySelectorAll(".tab").forEach((tab, i) =>
        tab.classList.toggle("active", i === index)
      );
      document.querySelectorAll(".content").forEach((content, i) =>
        content.classList.toggle("active", i === index)
      );
    }

    function updateTotals() {
      document.querySelectorAll(".content").forEach(content => {
        let totalPoints = 0;
        content.querySelectorAll("tbody tr").forEach(row => {
          const inputs = row.querySelectorAll("input");
          const type = inputs[0]?.dataset.type;
          let rowTotal = 0;

          if (type === "chore") {
            let checked = 0;
            inputs.forEach(input => {
              if (input.checked) checked++;
            });
            rowTotal = `${checked}/${inputs.length}`;
          } else if (type === "deduction") {
            let sum = 0;
            inputs.forEach(input => sum += parseInt(input.value || 0));
            rowTotal = sum;
            totalPoints -= sum;
          } else {
            let sum = 0;
            inputs.forEach(input => sum += parseInt(input.value || 0));
            rowTotal = sum;
            totalPoints += sum;
          }

          row.querySelector(".total").textContent = rowTotal;

          if (type === "chore") {
            totalPoints += (rowTotal.split("/")[0] * 1); 
          }
        });

        const kidName = content.previousSibling.textContent.trim();
        const bubble = [...document.querySelectorAll(".tab")]
          .find(tab => tab.textContent.includes(kidName))
          .querySelector(".rank-bubble");
        bubble.textContent = totalPoints;
      });

      updateProgressBar();
    }

    function updateProgressBar() {
      let totals = [...document.querySelectorAll(".rank-bubble")].map(b => parseInt(b.textContent));
      let max = Math.max(...totals);
      let current = totals.reduce((a, b) => a + b, 0);
      let percent = max ? Math.round((current / (max * totals.length)) * 100) : 0;
      const bar = document.getElementById("progressBar");
      bar.style.width = percent + "%";
      bar.textContent = percent + "%";
    }

    document.addEventListener("change", updateTotals);

    // Highlight current day (first row only)
    const today = new Date().getDay(); // 0 = Sunday
    const dayIndex = (today + 6) % 7; // shift so Monday = 0
    document.querySelectorAll("thead tr th").forEach((th, i) => {
      if (i - 1 === dayIndex) th.classList.add("current-day");
    });
  </script>
</body>
</html>
